{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Uninsured and in poverty\"\nauthor: \"Andrew Ba Tran\"\ndate: \"September 13, 2016\"\noutput: html_document\n---\n\n```{r setup, message=F, warning=F}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(extrafont)\nlibrary(ggalt)\nlibrary(scales)\nlibrary(gridExtra)\nlibrary(grid)\nlibrary(ggalt)\nlibrary(choroplethr)\n\n```\n\n```{r distribution, fig.width=8, fig.height=5}\n\n# Income distribution\n\ndist <- read.csv(\"data/distribution.csv\")\ndist <- dist[,1:5]\ndist_long <- dist %>%\n  gather(\"Income\", \"Total\", 2:5) %>%\n  arrange(Year)\n\ndist_long$Income <- gsub(\"X\", \"\", dist_long$Income)\ndist_long$Income <- gsub(\"\\\\.\", \" \", dist_long$Income)\ndist_long$Income <- gsub(\"  \", \" \", dist_long$Income)\ndist_long$Income <- str_trim(dist_long$Income)\n\nedu_colors <- c('#1b9e77', '#d95f02', '#7570b3', '#e7298a')\nnames(edu_colors) <- unique(dist_long$Income)\n\ncolnames(dist) <- gsub(\"X\", \"\",colnames(dist))\ncolnames(dist) <- gsub(\"\\\\.\", \" \",colnames(dist))\ncolnames(dist) <- gsub(\"  \", \" \", colnames(dist))\ncolnames(dist) <- str_trim(colnames(dist))\n\n\nlast_vals <- sapply(colnames(dist)[2:5], function(x) first(na.exclude(dist[,x])))\nlast_date <- c(2015, 2015, 2015, 2015)\n\n# jobs change (monthly)\n\ngg <- ggplot(dist_long)\ngg <- gg + geom_hline(yintercept = 0)\ngg <- gg + geom_line(aes(x=Year, y=Total, group=Income, color=Income))\n#gg <- gg + geom_rect(aes(xmin=as.numeric(ymd(\"2007-12-01\")), xmax=as.numeric(ymd(\"2010-01-01\")), ymin=-Inf, ymax=Inf))\ngg <- gg + annotate(\"rect\", xmin = 2007, xmax =2010, ymin = -Inf, ymax = Inf,\n                    alpha = .1)\ngg <- gg + scale_color_manual(name=\"\", values=edu_colors)\ngg <- gg + scale_y_continuous(labels = scales::dollar)\n#gg <- gg + scale_y_continuous(label=percent)\ngg <- gg + labs(x=NULL, y=NULL, title=\"Real household income at selected percentiles\",\n                subtitle=\"Income in thousands (2015 dollars).\",\n                caption=\"SOURCE: U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Helvetica\")\ngg <- gg + theme(axis.ticks.y=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(legend.key=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.caption=element_text(face=\"bold\", family=\"Lato\", size=9, color=\"gray\", margin=margin(t=10, r=80)))\ngg <- gg + theme(legend.position=\"none\")\ngg <- gg + theme(plot.margin = unit(c(1, 15, 1, 1), \"lines\"))\ngg\n\nfor (i in 1:length(last_vals)) {\n  gg <- gg + annotation_custom(grob=textGrob(paste0(names(last_vals)[i], \" ($\", formatC(round(last_vals[i],1), format=\"d\", big.mark=','), \")\"), hjust=-.3,\n                                             gp=gpar(fontsize=10, \n                                                     col=edu_colors[names(last_vals)[i]])),\n                               xmin=as.numeric(last_date[i]),xmax=as.numeric(last_date[i]),\n                               ymin=last_vals[i], ymax=last_vals[i])\n}\n\ngb <- ggplot_build(gg)\ngt <- ggplot_gtable(gb)\n\ngt$layout$clip[gt$layout$name==\"panel\"] <- \"off\"\ngrid.draw(gt)\n\n```\n\n# Median wages for men and women\n\n```{r men_women,  fig.width=8, fig.height=5}\n\ndist <- read.csv(\"data/menwomen.csv\")\ndist_long <- dist %>%\n  gather(\"Gender\", \"Wage\", 2:3) %>%\n  arrange(Year)\n\nedu_colors <- c('#1b9e77', '#d95f02')\nnames(edu_colors) <- unique(dist_long$Gender)\n\nlast_vals <- sapply(colnames(dist)[2:3], function(x) first(na.exclude(dist[,x])))\nlast_date <- c(2015, 2015)\n\n# median wage, men and women\n\ngg <- ggplot(dist_long)\ngg <- gg + geom_hline(yintercept = 0)\ngg <- gg + geom_line(aes(x=Year, y=Wage, group=Gender, color=Gender))\ngg <- gg + annotate(\"rect\", xmin = 2007, xmax =2010, ymin = -Inf, ymax = Inf,\n                    alpha = .1)\ngg <- gg + scale_color_manual(name=\"\", values=edu_colors)\ngg <- gg + scale_y_continuous(labels = scales::dollar)\ngg <- gg + labs(x=NULL, y=NULL, title=\"Real median earnings for men and women\",\n                subtitle=\"For full-time, year-round workers. In 2015 dollars. The wage gap continues to shrink.\",\n                caption=\"SOURCE: U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Helvetica\")\ngg <- gg + theme(axis.ticks.y=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(legend.key=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.caption=element_text(face=\"bold\", family=\"Lato\", size=9, color=\"gray\", margin=margin(t=10, r=80)))\ngg <- gg + theme(legend.position=\"none\")\ngg <- gg + theme(plot.margin = unit(c(1, 15, 1, 1), \"lines\"))\ngg\n\nfor (i in 1:length(last_vals)) {\n  gg <- gg + annotation_custom(grob=textGrob(paste0(names(last_vals)[i], \" ($\", formatC(round(last_vals[i],1), format=\"d\", big.mark=','), \")\"), hjust=-.3,\n                                             gp=gpar(fontsize=10, \n                                                     col=edu_colors[names(last_vals)[i]])),\n                               xmin=as.numeric(last_date[i]),xmax=as.numeric(last_date[i]),\n                               ymin=last_vals[i], ymax=last_vals[i])\n}\n\ngb <- ggplot_build(gg)\ngt <- ggplot_gtable(gb)\n\ngt$layout$clip[gt$layout$name==\"panel\"] <- \"off\"\ngrid.draw(gt)\n```\n\n# Diff between 2014 and 2015\n\n```{r 3_year_uninsured,  fig.width=7, fig.height=10}\n\nunin <- read.csv(\"data/uninsured.csv\")\n\nunin <- arrange(unin, diff1514)\nunin$State <- factor(unin$State, levels=unique(unin$State))\n\ngg <- ggplot()\ngg <- gg + geom_segment(data=unin, aes(y=State, yend=State, x=0, xend=20), color=\"#b2b2b2\", size=0.15)\ngg <- gg + geom_dumbbell(data=unin, aes(y=State, x=percent2014, xend=percent2015),\n                         size=1.5, color=\"#b2b2b2\", point.size.l=3, point.size.r=3,\n                         point.colour.l=\"#476b6b\", point.colour.r=\"#cc0052\")\n# text below points\ngg <- gg + geom_text(data=filter(unin, State==\"South Dakota\"),\n                     aes(x=percent2014, y=State, label=\"2014\"),\n                     color=\"#476b6b\", size=3, vjust=-2, hjust =1, fontface=\"bold\", family=\"Helvetica\")\ngg <- gg + geom_text(data=filter(unin, State==\"South Dakota\"),\n                     aes(x=percent2015, y=State, label=\"2015\"),\n                     color=\"#cc0052\", size=3, vjust=-2, hjust=-.1, fontface=\"bold\", family=\"Helvetica\")\n# text above points\ngg <- gg + geom_text(data=unin, aes(x=percent2014, y=State, label=percent2014),\n                     color=\"#476b6b\", size=2.75, vjust=2.5, family=\"Helvetica\")\ngg <- gg + geom_text(data=unin, color=\"#cc0052\", size=2.75, vjust=2.5, family=\"Helvetica\",\n                     aes(x=percent2015, y=State, label=percent2015))\n# difference column\ngg <- gg + geom_rect(data=unin, aes(xmin=20, xmax=21, ymin=-Inf, ymax=Inf), fill=\"#efefe3\")\ngg <- gg + geom_text(data=unin, aes(label=round(diff1514,2), y=State, x=20.5), fontface=\"bold\", size=3, family=\"Helvetica\")\ngg <- gg + geom_text(data=filter(unin, State==\"South Dakota\"), aes(x=20.5, y=State, label=\"Diff\"),\n                     color=\"#7a7d7e\", size=3.1, vjust=-2, fontface=\"bold\", family=\"Helvetica\")\ngg <- gg + scale_x_continuous(expand=c(0,0), limits=c(0, 21))\ngg <- gg + scale_y_discrete(expand=c(0.075,0))\ngg <- gg + labs(x=NULL, y=NULL, title=\"Change in uninsured rates by state\",\n                caption=\"Source: U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Helvetica\")\ngg <- gg + theme(panel.grid.major=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(axis.ticks=element_blank())\ngg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=7, margin=margin(t=12), color=\"#7a7d7e\"))\ngg\n```\n\n# Map of uninsured 2015\n\n```{r choropleth_un, fig.width=8, fig.height=5 }\n\nunin_map1 <- unin[c(\"State\", \"percent2015\")]\ncolnames(unin_map1) <- c(\"region\", \"value\")\nunin_map1$region <- str_to_lower(unin_map1$region)\nstate_choropleth(unin_map1, title = \"Uninsured rate in 2015\")\n\nunin_map1 <- unin[c(\"State\", \"diff1514\")]\ncolnames(unin_map1) <- c(\"region\", \"value\")\nunin_map1$region <- str_to_lower(unin_map1$region)\nstate_choropleth(unin_map1, title = \"Uninsured rate change between 2014 and 2015\")\n```\n\n\n# Diff between 2013 and 2015\n\n```{r 2013_2015,  fig.width=7, fig.height=10}\n\nunin <- arrange(unin, diff1513)\nunin$State <- factor(unin$State, levels=unique(unin$State))\n\ngg <- ggplot()\ngg <- gg + geom_segment(data=unin, aes(y=State, yend=State, x=0, xend=23), color=\"#b2b2b2\", size=0.15)\ngg <- gg + geom_dumbbell(data=unin, aes(y=State, x=percent2013, xend=percent2015),\n                         size=1.5, color=\"#b2b2b2\", point.size.l=3, point.size.r=3,\n                         point.colour.l=\"#476b6b\", point.colour.r=\"#cc0052\")\n# text below points\ngg <- gg + geom_text(data=filter(unin, State==\"Massachusetts\"),\n                     aes(x=percent2013, y=State, label=\"2013\"),\n                     color=\"#476b6b\", size=3, vjust=-2, hjust =-.1, fontface=\"bold\", family=\"Helvetica\")\ngg <- gg + geom_text(data=filter(unin, State==\"Massachusetts\"),\n                     aes(x=percent2015, y=State, label=\"2015\"),\n                     color=\"#cc0052\", size=3, vjust=-2, hjust=1, fontface=\"bold\", family=\"Helvetica\")\n# text above points\ngg <- gg + geom_text(data=unin, aes(x=percent2013, y=State, label=percent2013),\n                     color=\"#476b6b\", size=2.75, vjust=2.5, family=\"Helvetica\")\ngg <- gg + geom_text(data=unin, color=\"#cc0052\", size=2.75, vjust=2.5, family=\"Helvetica\",\n                     aes(x=percent2015, y=State, label=percent2015))\n# difference column\ngg <- gg + geom_rect(data=unin, aes(xmin=23, xmax=24, ymin=-Inf, ymax=Inf), fill=\"#efefe3\")\ngg <- gg + geom_text(data=unin, aes(label=round(diff1514,2), y=State, x=23.5), fontface=\"bold\", size=3, family=\"Helvetica\")\ngg <- gg + geom_text(data=filter(unin, State==\"Massachusetts\"), aes(x=23.5, y=State, label=\"Diff\"),\n                     color=\"#7a7d7e\", size=3.1, vjust=-2, fontface=\"bold\", family=\"Helvetica\")\ngg <- gg + scale_x_continuous(expand=c(0,0), limits=c(0, 24))\ngg <- gg + scale_y_discrete(expand=c(0.075,0))\ngg <- gg + labs(x=NULL, y=NULL, title=\"Change in uninsured rates by state, '13-'15\",\n                caption=\"Source: U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Helvetica\")\ngg <- gg + theme(panel.grid.major=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(axis.ticks=element_blank())\ngg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=7, margin=margin(t=12), color=\"#7a7d7e\"))\ngg\n```\n\n# Mapping poverty rates\n\n```{r choropleth1, fig.width=8, fig.height=5 }\npov <- read.csv(\"data/poverty.csv\")\n\npov_map1 <- pov[c(\"State\", \"Percent\")]\ncolnames(pov_map1) <- c(\"region\", \"value\")\npov_map1$region <- str_to_lower(pov_map1$region)\nstate_choropleth(pov_map1, title = \"Poverty rate by state in 2015\")\n\npov_map1 <- pov[c(\"State\", \"Diff.Percent\")]\npov_map1$Diff.Percent <- as.numeric(pov_map1$Diff.Percent)\ncolnames(pov_map1) <- c(\"region\", \"value\")\npov_map1$region <- str_to_lower(pov_map1$region)\nstate_choropleth(pov_map1, title = \"Poverty rate change between 2014 and 2015\")\n\n```\n",
    "created" : 1473779346461.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2203851100",
    "id" : "380905AB",
    "lastKnownWriteTime" : 1473810864,
    "last_content_update" : 1473810864140,
    "path" : "~/Documents/Github/trendct-data/2016/08/census_poverty_insurance/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}